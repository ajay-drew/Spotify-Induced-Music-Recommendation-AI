services:
  # Backend: FastAPI + Uvicorn, using the existing Dockerfile
  - type: web
    name: simrai-api
    env: docker
    plan: free
    region: oregon
    autoDeploy: true
    healthCheckPath: /health
    # Dockerfile CMD already runs: uvicorn simrai.api:app --host 0.0.0.0 --port 8000
    envVars:
      - key: SIMRAI_SPOTIFY_CLIENT_ID
        sync: false
      - key: SIMRAI_SPOTIFY_CLIENT_SECRET
        sync: false
      - key: SIMRAI_SPOTIFY_REDIRECT_URI
        value: https://simrai-api.onrender.com/auth/callback
      - key: GROQ_API_KEY
        sync: false
      - key: SIMRAI_LOG_LEVEL
        value: INFO

  # Frontend: React/Tailwind app built with Vite and served as static files
  - type: web
    name: simrai-web
    env: static
    plan: free
    region: oregon
    buildCommand: |
      cd web
      npm install
      npm run build
    staticPublishPath: web/dist
    envVars:
      # Point the frontend at the deployed backend URL
      - key: VITE_API_URL
        value: https://simrai-api.onrender.com


